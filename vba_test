Sub Button1_Click()
Dim index As Integer
Dim Ctype As String
Dim Ptype As String
Dim ding As Integer
Dim tuo As Integer
Dim yi As Integer
Dim yingshou As Single
Dim yingshouSum As Single
Dim shijishou As Single
Dim shijishouSum As Single
Dim CshipName As String
Dim PshipName As String
Dim StartL As Integer


Sheet4.Cells(1, 1).Value = "Ë÷Òý"
Sheet4.Cells(1, 2).Value = "´ó´¬"
Sheet4.Cells(1, 3).Value = "Ó¦ÊÕ"
Sheet4.Cells(1, 4).Value = "Êµ¼Ê"
Sheet4.Cells(1, 5).Value = "¶¥+ÍÏ+ÒÆ"
Sheet4.Cells(1, 6).Value = "¶¥"
Sheet4.Cells(1, 7).Value = "ÍÏ"
Sheet4.Cells(1, 8).Value = "ÒÆ"
Sheet4.Cells(1, 9).Value = "¿ªÊ¼ÐÐ"
Sheet4.Cells(1, 10).Value = "½áÊøÐÐ"

index = 2
StartL = 2

Ctype = Sheet3.Cells(2, 1).Value
Ptype = Sheet3.Cells(2, 1).Value
ding = 0
tuo = 0
yi = 0
If Ctype = "¶¥" Then
    ding = 1
ElseIf Ctype = "ÍÏ" Then
    tuo = 1
Else
    yi = 1
End If
yingshou = CInt(Sheet3.Cells(2, 2).Value)
yingshouSum = CInt(Sheet3.Cells(2, 2).Value)
shijishou = CInt(Sheet3.Cells(2, 3).Value)
shijishouSum = CInt(Sheet3.Cells(2, 3).Value)
CshipName = Sheet3.Cells(2, 4).Value
PshipName = Sheet3.Cells(2, 4).Value

For Row = 3 To 10818

Ctype = Sheet3.Cells(Row, 1).Value
yingshou = CInt(Sheet3.Cells(Row, 2).Value)
shijishou = CInt(Sheet3.Cells(Row, 3).Value)
CshipName = Sheet3.Cells(Row, 4).Value


If (CshipName = PshipName And ((Ptype = "¶¥" And Ctype = "ÍÏ") Or (Ptype = "¶¥" And Ctype = "¶¥") Or (Ptype = "ÍÏ" And Ctype = "ÍÏ") Or (Ptype = "ÒÆ" And Ctype = "ÒÆ"))) Then
    Ptype = Ctype
    PshipName = CshipName
    If Ctype = "¶¥" Then
        ding = ding + 1
    ElseIf Ctype = "ÍÏ" Then
        tuo = tuo + 1
    Else
        yi = yi + 1
    End If
    yingshouSum = yingshouSum + yingshou
    shijishouSum = shijishouSum + shijishou
Else
    Sheet4.Cells(index, 1).Value = index - 1
    Sheet4.Cells(index, 2).Value = PshipName
    Sheet4.Cells(index, 3).Value = yingshouSum
    Sheet4.Cells(index, 4).Value = shijishouSum
    Sheet4.Cells(index, 5).Value = ding + tuo + yi
    Sheet4.Cells(index, 6).Value = ding
    Sheet4.Cells(index, 7).Value = tuo
    Sheet4.Cells(index, 8).Value = yi
    Sheet4.Cells(index, 9).Value = StartL
    Sheet4.Cells(index, 10).Value = Row - 1
    index = index + 1
    Ptype = Ctype
    PshipName = CshipName
    yingshouSum = yingshou
    shijishouSum = shijishou
    ding = 0
    tuo = 0
    yi = 0
    If Ctype = "¶¥" Then
        ding = 1
    ElseIf Ctype = "ÍÏ" Then
        tuo = 1
    Else
        yi = 1
    End If
    StartL = Row
End If

Next Row

    Sheet4.Cells(index, 1).Value = index - 1
    Sheet4.Cells(index, 2).Value = PshipName
    Sheet4.Cells(index, 3).Value = yingshouSum
    Sheet4.Cells(index, 4).Value = shijishouSum
    Sheet4.Cells(index, 5).Value = ding + tuo
    Sheet4.Cells(index, 6).Value = ding
    Sheet4.Cells(index, 7).Value = tuo
    Sheet4.Cells(index, 8).Value = yi
    Sheet4.Cells(index, 9).Value = StartL
    Sheet4.Cells(index, 10).Value = Row - 1
    
End Sub
